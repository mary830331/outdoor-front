<template>
<div>
  <admin/>
  <div class="top-mt left-layout-lg " >
        <div class="justify-center row margin-15">
            <q-dialog
              v-model="Forum"
              >
                <q-card style="width: 700px; max-width: 80vw;">
                  <q-form
            @submit="onSubmit"
            @reset="onReset"
            class="q-ma-xl row"
          >
            <q-input
            class="col-12"
              filled
              dense
              v-model="forum.title"
              label="Ê®ôÈ°å"
              lazy-rules
              :rules="[ val => val && val.length > 0 || 'Ë´ãÂãøÁ©∫ÁôΩ']"
            />
            <div class=" col-6">‰∏äÊû∂ÊñáÁ´†
            <div class="q-ml-md q-my-md">
            <q-radio dense  v-model="forum.sell" val="true" :value="true" label="‰∏äÊû∂" />
            <q-radio dense v-model="forum.sell" val="false" :value="false" label="‰∏ãÊû∂" />
            </div>
            </div>
            <div class="col-6">
              Ê™îÊ°à‰∏äÂÇ≥
              <img-inputer
              accept="image/*"
              v-model="forum.image"
              theme="light"
              size="normal"
              bottom-text="ÈªûÈÅ∏ÊàñÊãñÊãΩÂúñÁâá‰ª•‰øÆÊîπ"
              hover-text="ÈªûÈÅ∏ÊàñÊãñÊãΩÂúñÁâá‰ª•‰øÆÊîπ"
              placeholder="ÈªûÈÅ∏ÊàñÊãñÊãΩÈÅ∏ÊìáÂúñÁâá"
              :max-size="1024"
              exceed-size-text="Ê™îÊ°àÂ§ßÂ∞è‰∏çËÉΩË∂ÖÈÅé">
              </img-inputer>
            </div>

            <q-input
              filled
              label="ÂÖßÂÆπ"
              type="textarea"
              lazy-rules
              class="col-12"
              v-model="forum.content"
            />

            <div class="q-mt-md">
              <q-btn label="Submit" type="submit" color="primary"/>
              <q-btn label="Reset" type="reset" color="primary" flat class="q-ml-sm" />
            </div>
          </q-form>
          </q-card>
    </q-dialog>

    <q-dialog
        v-model="Group"
        label="Êè™ÂúòÊñáÁ´†"
        >
          <q-card
          style="width: 700px; max-width: 80vw;">
            <q-form
            @submit="onSubmit"
            @reset="onReset"
            class="q-ma-xl row"
          >
            <div class="col-6">
              <q-input
              filled
              dense
              v-model="group.name"
              label="üìçÂú∞ÈªûÊ®ôÈ°å"
              lazy-rules
              class="col-6"
              :rules="[ val => val && val.length > 0 || 'Ë´ãÂãøÁ©∫ÁôΩ']"
            />
            <q-input
              filled
              dense
              v-model="group.time"
              label="üïñÊôÇÈñì"
              :rules="[ val => val && val.length > 0 || 'Ë´ãÂãøÁ©∫ÁôΩ']"
            />

            <q-select
              filled
              dense
              v-model="group.category"
              label="Ê¥ªÂãïÂàÜÈ°û"
              :options="categories"
              lazy-rules
              :rules="[ val => val && val.length > 0 || 'Ë´ãÂãøÁ©∫ÁôΩ']"
            />
            <div class="q-my-sm q-mb-xs">‰∏äÊû∂Ê¥ªÂãï
            <div class="q-gutter-xl">
            <q-radio dense v-model="group.sell" val="true" :value="true" label=" ‰∏äÊû∂ üî∫" />
            <q-radio dense v-model="group.sell" val="false" :value="false" label=" ‰∏ãÊû∂ üîª" />
            </div>
            </div>
            </div>
            <div class="col-6">
              <q-input
              filled
              dense
              v-model="group.price"
              label="üí∞È†ê‰º∞È†êÁÆóÈáëÈ°ç"
              lazy-rules
              class="q-ml-md "
              :rules="[ val => val && val.length > 0 || 'Ë´ãÂãøÁ©∫ÁôΩ']"
            />
              <p class="q-ml-md">Ê™îÊ°à‰∏äÂÇ≥</p>
              <img-inputer
              class="q-ml-md"
              style="width: 95%;"
              accept="image/*"
              v-model="group.image"
              theme="light"
              size="normal "
              bottom-text="ÈªûÈÅ∏ÊàñÊãñÊãΩÂúñÁâá‰ª•‰øÆÊîπ"
              hover-text="ÈªûÈÅ∏ÊàñÊãñÊãΩÂúñÁâá‰ª•‰øÆÊîπ"
              placeholder="ÈªûÈÅ∏ÊàñÊãñÊãΩÈÅ∏ÊìáÂúñÁâá"
              :max-size="1024"
              exceed-size-text="Ê™îÊ°àÂ§ßÂ∞è‰∏çËÉΩË∂ÖÈÅé">
              </img-inputer>
            </div>
            <q-input
              filled
              dense
              label="Ê¥ªÂãïË°åÁ®ã"
              type="textarea"
              lazy-rules
              v-model="group.description"
              class="q-mt-sm col-12"
            />
            <div class="col-12 q-mt-xs">
              Ê≥®ÊÑè‰∫ãÈ†Ö
            <q-input
              filled
              dense
              type="textarea"
              lazy-rules
              v-model="group.precautions"
            /></div>

            <div class="q-mt-md">
              <q-btn label="Submit" type="submit" color="primary"/>
              <q-btn label="Reset" type="reset" color="primary" flat class="q-ml-sm" />
            </div>
          </q-form>
          </q-card>
    </q-dialog>

<q-card class="col-12">
        <q-tabs
          v-model="tab"
          dense
          class="text-grey"
          active-color="negative"
          indicator-color="negative"
          align="justify"
          narrow-indicator
        >
          <q-tab name="Forum-btn" label="Ë®éË´ñÂçÄÊñáÁ´†" />
          <q-tab name="Group-btn" label="Êè™ÂúòÊñáÁ´†"/>
        </q-tabs>

        <q-separator />

        <q-tab-panels v-model="tab" animated>
          <q-tab-panel name="Forum-btn">
            <q-btn style="width: 30%;" color="negative" label="Êñ∞Â¢û" @click="Forum = true" />
            <q-table
              :data="products"
              :columns="columns"
              ref='table'
              :title="group._id.length > 0 ? 'Á∑®ËºØË®éË´ñÂçÄÊñáÁ´†' : 'Êñ∞Â¢ûË®éË´ñÂçÄÊñáÁ´†'"
            />
          </q-tab-panel>
          <q-tab-panel name="Group-btn" >
            <q-btn style="width: 30%;" color="negative" label="Êñ∞Â¢û"
            @click="Group = true" />
            <q-table
              :data="products"
              :columns="columns"
              grid
              ref='table'
              :title="group._id.length > 0 ? 'Á∑®ËºØÊè™ÂúòÊñáÁ´†' : 'Êñ∞Â¢ûÊè™ÂúòÊñáÁ´†'"
            >
              <template v-slot:item="props" >
              <div class=" col-sm-6 col-md-4 col-lg-3 col-xs-12" >
            <q-card class=" text-grey-8 q-ma-sm">
              <img :src="props.row.image" class="text-center"  style="width: 100%; height: 150px;">
              <div class="q-pa-sm">
              <q-card-section class="text-center q-pa-none">
              <strong class="text-weight-bold text-h6">{{ props.row.name }}</strong>
            </q-card-section>
            <q-card-section class="text-center q-pa-none">
              <strong class="text-weight-light text-body2">È†ê‰º∞ÈáëÈ°ç:<br>{{ props.row.price }}</strong>
            </q-card-section>
            <q-card-section class="text-center q-pa-none">
              <strong class="col-6 text-weight-light text-body2">ÂàÜÈ°û:{{ props.row.category }}</strong>
            </q-card-section>
            <q-card-section class="text-center row q-pa-xs">
              <strong class="col-6 text-weight-light">‰∏äÊû∂: {{ props.row.sell ? '‚≠ï' : '‚ùå' }}</strong>
              <q-btn rounded size="xs" color="secondary" label="Á∑®ËºØ" @click='editProduct(props.pageIndex)'/>
            </q-card-section>
            </div>
            </q-card>
                </div>
              </template>
            </q-table>
          </q-tab-panel>

        </q-tab-panels>
      </q-card>
      </div>
    </div>
</div>
</template>

<script>
import Admin from 'src/components/Admin.vue'
export default {
  name: 'AdminArrticle',
  data () {
    return {
      columns: [
        { name: 'image', label: 'ÂúñÁâá', field: 'image' },
        { name: 'name', label: 'Ê¥ªÂãïÂêçÁ®±', field: 'name' },
        { name: 'price', label: 'È†ê‰º∞ÂÉπÊ†º', field: 'price' },
        { name: 'category', label: 'ÂàÜÈ°û ', field: 'category' },
        { name: 'sell', label: '‰∏äÊû∂', field: 'sell' },
        { name: 'action', label: 'Êìç‰Ωú', field: 'action' }
      ],
      tab: 'Forum-btn',
      forum: {
        title: '',
        description: '',
        sell: 'true',
        images: null
      },
      Forum: false,
      Group: false,
      group: {
        name: '',
        time: '',
        price: '',
        description: '',
        image: null,
        sell: 'true',
        category: '',
        precautions: `1.È£üÂÆøËá™ÁêÜ\n2.Âá∫ÁôºÂâç‰∏âÂ§©Ë¶ñÊ∞£Ë±°È†êÂ†±Ê±∫ÂÆöÊòØÂê¶Âá∫Áôº\n3.Ë¶ñÊÉÖÊ≥ÅË™øÊï¥Ë°åÁ®ãÔºå‰∏ªÊè™ÊúâÊ¨äÊ±∫ÂÆöÊòØÂê¶Êí§ÈÄÄ\n4.È†àÂÖ∑ÂÇôÁç®Ëá™Ëµ∞ÂÆåÂÖ®Á®ãÁöÑËÉΩÂäõÔºå‰∏ªÊè™Âè™ÊòØÊÉ≥Êâæ‰∫∫ÂêåË°åÔºåÊ≤íÊúâÂπ´‰∫∫ËÉåÊù±Ë•ø.ÊâæË∑Ø.ÂàÜ‰∫´Ë£ùÂÇôÁöÑÁæ©Âãô\n5.ÈúÄÈÖçÂêàÂèÉËàáË°åÂâçÂÆâÂÖ®Ë©ï‰º∞ÊúÉË≠∞ÔºåÁ¢∫Ë™çÂêåË°åËÄÖÊúâË£Ω‰ΩúÂú∞Âúñ‰∏îÂÖ∑ÂÇôË∂≥Â§†ÁôªÂ±±Áü•Ë≠ò\n6.Ëã•ÊúâË°åÂâçÈ´îË®ìË´ãÁõ°ÈáèÂèÉÂä†ÔºåÂèØËÉΩÊòØÂÖàÁ¥ÑÂ∫ßÁ∞°ÂñÆÁöÑÂ±±Áà¨‰∫íÁõ∏Ë™çË≠òÔºåË∑üÂÆåÂÖ®ÈôåÁîü‰∫∫Áà¨Èï∑Â§©Êï∏ÊúÉÊäñ\n7.ÊúâÊÖ¢ÊÄßÁñæÁóÖË´ã‰∫ãÂÖàÂëäÁü•ÔºåÈö®ÂúòÁÑ°ÈÜ´ÁîüËÉΩÊÄ•Êïë\n8.Ê≠§ÁÇ∫Ëá™ÁµÑÂúòÔºåÂèØ‰∏ÄËµ∑Áî≥Ë´ãÂÖ•ÂúíÂÖ•Â±±Ôºå‰∏ªÊè™ÈùûÈ†òÈöä„ÄÅÂöÆÂ∞é„ÄÅ‰øùÂßÜ‰πãËÅ∑ÔºåÂè™ÊòØÁÜ±ÂøÉÁôºËµ∑Ê¥ªÂãï„ÄÇÊúÉË¶ÅÊ±ÇÁ∞ΩÁΩ≤È¢®Èö™Ëá™Ë≤†ÂêåÊÑèÊõ∏\n9.ÂèÉËàáÁöÑÂ§•‰º¥ÂÄëË°åÈÄ≤Èñì‰∫íÂä©Âêà‰ΩúÂèäÂÆâÂÖ®ÊèêÈÜí\n
`,
        _id: '',
        authorId: '',
        authorName: '',
        authorAge: '',
        authorNews: '',
        authorImg: '',
        index: -1
      },
      products: [],
      categories: [
        'ÁôæÂ≤≥', '‰∏≠Á¥öÂ±±', 'ÈÉäÂ±±', 'Êé¢Âãò', 'ÁßòÂ¢É', 'Èú≤Ááü', 'ÈáéÊ∫™Ê∫´Ê≥â', 'Ê∫ØÊ∫™', 'Ê∞¥ËÇ∫ÊΩõÊ∞¥', 'Ëá™Áî±ÊΩõÊ∞¥', 'SUP', 'Ë°ùÊµ™', 'ÂÖ∂‰ªñ'
      ]
    }
  },
  components: {
    Admin
  },
  computed: {
    // filterGroup () {
    //   return this.products.filter(item => {
    //     if (item.authorId === this.$store.getters['user/user']._id) return true
    //     console.log('A' + item.authorId)
    //     return true
    //   })
    // }
  },
  methods: {
    // onSubmit () {
    //   this.$q.notify({
    //     color: 'positive',
    //     icon: 'check_circle',
    //     message: 'ÁôºË°®ÊàêÂäü !'
    //   })
    // },
    async onSubmit (event) {
      event.preventDefault()
      const fd = new FormData()
      for (const key in this.group) {
        if (key !== '_id') {
          fd.append(key, this.group[key])
        }
      }

      try {
        if (this.group._id.length === 0) {
          const { data } = await this.api.post('/products', fd, {
            headers: {
              authorization: 'Bearer ' + this.$store.getters['user/user'].token
            }
          })
          this.products.push(data.result)
          this.$q.notify({
            color: 'positive',
            icon: 'check_circle',
            message: 'ÁôºË°®ÊàêÂäü !'
          })
        } else {
          const { data } = await this.api.patch('/products/' + this.group._id, fd, {
            headers: {
              authorization: 'Bearer ' + this.$store.getters['user/user'].token
            }
          })
          this.products[this.group.index] = { ...this.group, image: data.result.image }
        }
        this.Group = false
      } catch (error) {
        this.$q.notify({
          color: 'positive',
          icon: 'error',
          message: `ÈåØË™§ ${error.response.data.message}`
        })
        console.log(error)
      }
    },
    onReset (event) {
      if (this.modalSubmitting) {
        event.preventDefault()
        return
      }
      this.forum.title = null
      this.forum.description = null
      this.forum.images = null
      this.forum.content = null
      this.forum.sell = 'true'
      this.group.name = null
      this.group.time = null
      this.group.price = null
      this.group.description = null
      this.group.images = null
      this.group.sell = 'true'
      this.group.precautions = `1.È£üÂÆøËá™ÁêÜ\n2.Âá∫ÁôºÂâç‰∏âÂ§©Ë¶ñÊ∞£Ë±°È†êÂ†±Ê±∫ÂÆöÊòØÂê¶Âá∫Áôº\n3.Ë¶ñÊÉÖÊ≥ÅË™øÊï¥Ë°åÁ®ãÔºå‰∏ªÊè™ÊúâÊ¨äÊ±∫ÂÆöÊòØÂê¶Êí§ÈÄÄ\n4.È†àÂÖ∑ÂÇôÁç®Ëá™Ëµ∞ÂÆåÂÖ®Á®ãÁöÑËÉΩÂäõÔºå‰∏ªÊè™Âè™ÊòØÊÉ≥Êâæ‰∫∫ÂêåË°åÔºåÊ≤íÊúâÂπ´‰∫∫ËÉåÊù±Ë•ø.ÊâæË∑Ø.ÂàÜ‰∫´Ë£ùÂÇôÁöÑÁæ©Âãô\n5.ÈúÄÈÖçÂêàÂèÉËàáË°åÂâçÂÆâÂÖ®Ë©ï‰º∞ÊúÉË≠∞ÔºåÁ¢∫Ë™çÂêåË°åËÄÖÊúâË£Ω‰ΩúÂú∞Âúñ‰∏îÂÖ∑ÂÇôË∂≥Â§†ÁôªÂ±±Áü•Ë≠ò\n6.Ëã•ÊúâË°åÂâçÈ´îË®ìË´ãÁõ°ÈáèÂèÉÂä†ÔºåÂèØËÉΩÊòØÂÖàÁ¥ÑÂ∫ßÁ∞°ÂñÆÁöÑÂ±±Áà¨‰∫íÁõ∏Ë™çË≠òÔºåË∑üÂÆåÂÖ®ÈôåÁîü‰∫∫Áà¨Èï∑Â§©Êï∏ÊúÉÊäñ\n7.ÊúâÊÖ¢ÊÄßÁñæÁóÖË´ã‰∫ãÂÖàÂëäÁü•ÔºåÈö®ÂúòÁÑ°ÈÜ´ÁîüËÉΩÊÄ•Êïë\n8.Ê≠§ÁÇ∫Ëá™ÁµÑÂúòÔºåÂèØ‰∏ÄËµ∑Áî≥Ë´ãÂÖ•ÂúíÂÖ•Â±±Ôºå‰∏ªÊè™ÈùûÈ†òÈöä„ÄÅÂöÆÂ∞é„ÄÅ‰øùÂßÜ‰πãËÅ∑ÔºåÂè™ÊòØÁÜ±ÂøÉÁôºËµ∑Ê¥ªÂãï„ÄÇÊúÉË¶ÅÊ±ÇÁ∞ΩÁΩ≤È¢®Èö™Ëá™Ë≤†ÂêåÊÑèÊõ∏\n9.ÂèÉËàáÁöÑÂ§•‰º¥ÂÄëË°åÈÄ≤Èñì‰∫íÂä©Âêà‰ΩúÂèäÂÆâÂÖ®ÊèêÈÜí\n
      `
      this.group.category = ''
    },
    editProduct (index) {
      this.group = { ...this.products[index], image: null, index }
      this.Group = true
    }
  },
  async created () {
    try {
      // Êäì‰ΩúËÄÖID authorId
      this.group.authorId = this.$store.getters['user/user']._id
      this.group.authorName = this.$store.getters['user/user'].name
      this.group.authorAge = this.$store.getters['user/user'].age
      this.group.authorNews = this.$store.getters['user/user'].news
      this.group.authorImg = this.$store.getters['user/user'].image
      const { data } = await this.api.get('/products/all/' + this.$route.params.id, {
        headers: {
          authorization: 'Bearer ' + this.$store.getters['user/user'].token
        }
      })
      this.products = data.result
    } catch (error) {
      console.log(error)
      this.$q.notify({
        color: 'positive',
        icon: 'error',
        message: 'ÂèñÂæóÂïÜÂìÅÂ§±Êïó'
      })
    }
  }
}
</script>
